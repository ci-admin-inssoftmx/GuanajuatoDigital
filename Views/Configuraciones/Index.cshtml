@model GuanajuatoAdminUsuarios.Models.ActualizaLoginResponseModel
<script>
	function replaceTextWithDots(input) {
		let hiddenFieldId = input.getAttribute('data-hidden-field-id');

		let realValue = document.getElementById(hiddenFieldId).value;

		if (input.value.length > realValue.length) {
			realValue += input.value[input.value.length - 1];
		} else {
			realValue = realValue.slice(0, input.value.length);
		}

		let hiddenValue = '';
		for (let i = 0; i < input.value.length; i++) {
			hiddenValue += '•'; 
		}
		input.value = hiddenValue;

		document.getElementById(hiddenFieldId).value = realValue;
	}
</script>
<div class="mainContainer bg-light">

	<section class="mx-md-3 mx-lg-4 mx-xl-5 bg-white boxShadow my-5 rounded">

		<div class="row px-4 px-md-4 pt-3 pb-2">
			<div class="">
				<form id="frmActualizarContra">
					<div class="tab-content" id="nav-tabContent">
						<div class="tab-pane tabCustomConteiner fade show active" id="informacionInfraccion-container" role="tabpanel" aria-labelledby="informacionInfraccion-tab">
							<div class="row align-items-center justify-content-between px-4 px-md-4 pt-3 pb-2">
                                <div class="col-12">
                                    <div class="row align-items-center justify-content-center justify-content-md-start">
                                        <div class="col-auto">
                                            <i class="icon-fisica h1 colorPrimary"></i>
                                        </div>
                                        <div class="col-auto my-3">
                                            <h5 class="px-4"><b>Actualizar contraseña</b></h5>
                                        </div>
                                    </div>
                                    <div class="row align-items-end my-4 px-4">
                                        <div class="form-group col-12 col-md-6 col-lg-4 col-xl-3 col-xx-2">
                                            <div class="controlForm my-3">
                                                @(Html.Kendo().TextBoxFor(t => t.Contrasena)
														.Label(l => l.Content("Contraseña actual <b>(Obligatorio)</b>:"))
														.Placeholder("Contraseña actual")
														.HtmlAttributes(new { style = "width: 100%", required = "required", oninput = "replaceTextWithDots(this)", @data_hidden_field_id = "realContrasena" })
														)
                                            </div>

                                            <input type="hidden" id="realContrasena" name="Contrasena" />
                                        </div>
                                        <div class="form-group col-12 col-md-6 col-lg-4 col-xl-3 col-xx-2">
                                            <div class="controlForm my-3">
                                                @(Html.Kendo().TextBoxFor(t => t.NuevaContrasena)
														.Label(l => l.Content("Nueva contraseña <b>(Obligatorio)</b>:"))
														.Placeholder("Nueva contraseña")
														.HtmlAttributes(new { style = "width: 100%", required = "required", oninput = "replaceTextWithDots(this)", @data_hidden_field_id = "realNuevaContrasena" })
														)
                                            </div>

                                            <input type="hidden" id="realNuevaContrasena" name="ConfirmarContrasena" />
                                        </div>
                                        <div class="form-group col-12 col-md-6 col-lg-4 col-xl-3 col-xx-2">
                                            <div class="controlForm my-3">
                                                @(Html.Kendo().TextBoxFor(t => t.ConfirmarContrasena)
														.Label(l => l.Content("Confirmar contraseña <b>(Obligatorio)</b>:"))
														.Placeholder("Confirmar contraseña")
														.HtmlAttributes(new { style = "width: 100%", required = "required", oninput = "replaceTextWithDots(this)", @data_hidden_field_id = "realConfirmarContrasena" })
														)
                                            </div>

                                            <input type="hidden" id="realConfirmarContrasena" name="OtraContrasena" />
                                        </div>
                                        <div class="form-group col-12 col-md-6 col-lg-4 col-xl-3 col-xx-2">
                                            <div class="controlForm my-3">
                                                <div class="btnOutline btnOutlinePrimary mx-auto p-0">
                                                    <button class="col-12 text-center" type="button" onclick="btnActualizar()">
                                                        <h6 class="m-0"><b>Actualizar</b></h6>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-12">
							<div class="tabCustomEnd"></div>
						</div>
					</div>
				</form>
			</div>
		</div>
	</section>

</div>

<script>
	function btnActualizar() {
		// Obtener los valores reales de los campos ocultos
		var Contrasena = $("#realContrasena").val();
		var NuevaContrasena = $("#realNuevaContrasena").val();
		var ConfirmarContrasena = $("#realConfirmarContrasena").val();

		console.log("VAL", Contrasena);
		showLoading();

		if (NuevaContrasena == "" || ConfirmarContrasena == "" || Contrasena == "") {
			sitteg_warning('Ingrese los datos solicitados');
			hideLoading();
			return;
		}
		if (NuevaContrasena === Contrasena) {
			sitteg_warning('La contraseña nueva no puede ser la misma que la actual');
			hideLoading();
			return;
		}

		if (NuevaContrasena == ConfirmarContrasena) {
			$.ajax({
				url: '@Url.Action("ActualizarContra", "Configuraciones")',
				type: 'POST',
				data: {
					"NuevaContrasena": NuevaContrasena,
					"Contrasena": Contrasena
				},
				success: function (result) {
					$("#Contrasena").val('');
					$("#NuevaContrasena").val('');
					$("#ConfirmarContrasena").val('');
					$("#realContrasena").val('');
					$("#realNuevaContrasena").val('');
					$("#realConfirmarContrasena").val('');
					sitteg_success('La contraseña se actualizó exitosamente.');
					hideLoading();
				},
				error: function (error) {
					if (error.responseJSON && error.responseJSON === "La contraseña proporcionada no es correcta.") {
						sitteg_warning('La contraseña actual no es correcta.');
					} else if (error.responseText && error.responseText.includes("La contraseña proporcionada no es correcta.")) {
						sitteg_warning('La contraseña actual no es correcta.');
					} else {
						sitteg_warning('Sucedió un error, intente más tarde...');
					}
					hideLoading();
				}
			});
		} else {
			sitteg_warning('La contraseña nueva no coinciden');
			hideLoading();
		}
	}

</script>


